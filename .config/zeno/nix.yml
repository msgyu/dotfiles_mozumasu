snippets:
  # nix-darwin (hostname is auto-detected)
  - name: nix switch
    keyword: nix-switch
    snippet: sudo darwin-rebuild switch --flake $DOTFILES_DIR/.config/nix#$(scutil --get LocalHostName)

  - name: nix build
    keyword: nix-build
    snippet: darwin-rebuild build --flake $DOTFILES_DIR/.config/nix#$(scutil --get LocalHostName)

  - name: nix check
    keyword: nix-check
    snippet: darwin-rebuild check --flake $DOTFILES_DIR/.config/nix#$(scutil --get LocalHostName)

  # nix flake
  - name: nix flake update
    keyword: nfu
    snippet: nix flake update --flake $DOTFILES_DIR/.config/nix

  - name: nix flake show
    keyword: nfs
    snippet: nix flake show $DOTFILES_DIR/.config/nix

  # garbage collection
  - name: nix garbage collect
    keyword: ngc
    snippet: nix-collect-garbage -d

completions:
  # nix run apps (dotfiles の flake apps を補完)
  - name: nix run apps
    patterns:
      - "^nix run \\.#$"
    sourceCommand: "/nix/var/nix/profiles/default/bin/nix flake show $DOTFILES_DIR/.config/nix --json 2>/dev/null | jq -r '.apps[\"aarch64-darwin\"] // {} | keys[]'"
    options:
      --prompt: "'nix run .#> '"
